http_port: 8222
listen=4222

debug: $NATS_DEBUG_MODE
trace: $NATS_TRACE_MODE

accounts {
    SYS: {
        users: [
            {
                user: sys,
                password: $NATS_SYS_USER_PASSWORD
            }
        ]
    }
    AUTH: {
        jetstream: enabled

        # Users authenticated via password
        users: [
            {
                user: regular_user,
                password: $NATS_REGULAR_USER_PASSWORD
            }
        ]
    }
}

system_account: SYS

authorization {
    # Centralized auth callout used only for AUTH account token-based users
    auth_callout {
        issuer: $NATS_AUTH_NKEY_ISSUER_PUBLIC
        account: AUTH
        auth_users: [ regular_user ]
        xkey: $NATS_AUTH_XKEY_ISSUER_PUBLIC
    }
}

jetstream {
    store_dir: /data/jetstream
    max_mem: 1G
    max_file: 100G
    domain: lixpi
    # Each server will have a unique tag based on its hostname - set by entrypoint
    unique_tag: "$NATS_SERVER_NAME"
}

cluster {
    name: $NATS_CLUSTER_NAME
    listen: 0.0.0.0:6222

    # Enable cluster auto-discovery
    connect_retries: 120

    # Authorization for cluster connections
    authorization {
        user: sys
        password: $NATS_SYS_USER_PASSWORD
    }

    # Routes will be passed via command line arguments or discovered dynamically
}

# The server_name will be set dynamically based on hostname when using NATS_SERVER_NAME_BASE environment variable
server_name: $NATS_SERVER_NAME

server_tags: ["cloud:aws", "region:us-east1", "az:a"]

websocket {
    # Specify a host and port to listen for websocket connections
    listen: "0.0.0.0:443"

    # TLS configuration with certificates from certificate manager
    tls {
        cert_file: "/etc/ssl/certs/server.crt"
        key_file: "/etc/ssl/private/server.key"
    }

    # [Cross-origin resource sharing option](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS).
    same_origin: $NATS_SAME_ORIGIN

    # List of accepted origins - must match browser Origin header exactly
    # When empty and same_origin is false, all origins are allowed
    # For production, this should be set via NATS_ALLOWED_ORIGINS environment variable
    allowed_origins: $NATS_ALLOWED_ORIGINS

    # This enables support for compressed websocket frames
    compression: true
}