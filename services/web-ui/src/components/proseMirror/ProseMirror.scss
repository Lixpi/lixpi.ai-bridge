@import '$src/sass/variables.scss';
@import '$src/components/proseMirror/plugins/bubbleMenuPlugin/bubbleMenu.scss';
@import '$src/components/proseMirror/plugins/linkTooltipPlugin/linkTooltip.scss';
@import '$src/components/proseMirror/plugins/slashCommandsMenuPlugin/slashCommandsMenu.scss';
@import '$src/components/proseMirror/plugins/aiChatThreadPlugin/ai-chat-thread.scss';
@import '$src/components/proseMirror/plugins/imageSelectionPlugin/imageSelection.scss';
@import '$src/components/proseMirror/ProseMirrorMixings.scss';

.ProseMirror {
	&::spelling-error {
		border: 1px solid orange;
		text-decoration: wavy orange;
	}
	min-height: calc(100% - 36px); // Important stuff, makes the editor to take the full height when the content is empty, but doesn't prevent it from growing when the content is long
	width: 100%;
	position: relative;
	word-wrap: break-word;
	white-space: pre-wrap;
	white-space: break-spaces;
	font-variant-ligatures: none;
	font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
	line-height: 1.2;
	outline: none;
	padding: 1rem 6rem 4rem;
	padding: 1rem 1rem 3rem 4rem;
	background: #fff;
	-webkit-font-variant-ligatures: none;
	h1.document-title {
		margin-top: .5rem;
		margin-bottom: 1.5rem;

		// font-size: 30px;
		// line-height: 1.3;
		// letter-spacing: -.0167em;
		// font-weight: 400;
	}
	// pre {
	// 	white-space: pre-wrap;
	// 	border: 1px solid #bababa;
	// 	padding: .7rem .7rem;
	// 	box-shadow: 1px 1px 11px 0px #dadee0;
	// 	border-radius: 7px;
	// 	background: red;
	// }
	code {
		color: $inlineCodeTextColor;
		word-spacing: -5px;
		font-style: italic;
		padding-right: 2px;
		font-weight: 500;
	}
	li {
		position: relative;
	}
	p {
		margin-bottom: 1em;
		margin-bottom: 0.4rem;
		font-size: 1rem;
		margin-bottom: 0;
		line-height: 1.45rem;
		position: relative;
		&::spelling-error {
			border: 1px solid orange;
			text-decoration: wavy orange;
		}

	}

	.empty-node-placeholder:before {    // Placeholder text for the document title node
		content: attr(data-placeholder);
		color: $light-grey;
		pointer-events: none;
		position: absolute;
		font-style: italic;
	}
	.empty-node-placeholder:empty:before {
		display: block;
	}
	/* Also show placeholder when the only child is the PM trailing BR */
	.empty-node-placeholder:has(> br.ProseMirror-trailingBreak:only-child):before {
		display: block;
	}
}




// Bugfix for Safari, without this it's not possible to place the cursor in empty paragraphs
@supports (background: -webkit-named-image(i)) {
	.empty-node-placeholder:has(> br.ProseMirror-trailingBreak:only-child),
	p:has(> br.ProseMirror-trailingBreak:only-child) {
		border: 0.1px solid #fff;
	}
}
// &:has(> br.ProseMirror-trailingBreak:only-child):after {
	// content: '\200B';    //Zero-width space
	// border: 1px solid red;
	// display: inline
// }
// END : Bugfix for Safari, without this it's not possible to place the cursor in empty paragraphs




//TODO rename, refactor
.ProseMirror-example-setup-style {
	/* Add space around the hr to make clicking it easier */
	hr {
		padding: 2px 10px;
		border: none;
		margin: 1em 0;
		&:after {
			content: "";
			display: block;
			height: 1px;
			background-color: silver;
			line-height: 2px;
		}
	}
	img {
		cursor: default;
	}
}

.ProseMirror-hideselection *::selection { background: transparent; }
.ProseMirror-hideselection *::-moz-selection { background: transparent; }
.ProseMirror-hideselection { caret-color: transparent; }


// Commented out to disable ugly outline around selected nodes.
// Though keeping commented code as a reference so that I remember that there's such class bein applied to selected nodes
// .ProseMirror-selectednode {
// 	outline: 2px solid #8cf;
// }

/* Make sure li selections wrap around markers */

li.ProseMirror-selectednode {
	outline: none;
}

li.ProseMirror-selectednode:after {
	content: "";
	position: absolute;
	left: -32px;
	right: -2px; top: -2px; bottom: -2px;
	border: 2px solid #8cf;
	pointer-events: none;
}

/* Protect against generic img rules */

img.ProseMirror-separator {
	display: inline !important;
	border: none !important;
	margin: 0 !important;
}
.ProseMirror-textblock-dropdown {
	min-width: 3em;
}












.ProseMirror-gapcursor {
	display: none;
	pointer-events: none;
	position: absolute;
}

.ProseMirror-gapcursor:after {
	content: "";
	display: block;
	position: absolute;
	top: -2px;
	width: 20px;
	border-top: 1px solid black;
	animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
	to {
		visibility: hidden;
	}
}

.ProseMirror ul, .ProseMirror ol {
	padding-left: 30px;
}

.ProseMirror blockquote {
	padding-left: 1em;
	border-left: 3px solid #eee;
	margin-left: 0; margin-right: 0;
}




//TODO: *************************************************** REMOVE WHEN REFACTORED ***************************************************
.ProseMirror-prompt {
	background: white;
	padding: 5px 10px 5px 15px;
	border: 1px solid silver;
	position: fixed;
	border-radius: 3px;
	z-index: 11;
	box-shadow: -.5px 2px 5px rgba(0, 0, 0, .2);
}

.ProseMirror-prompt h5 {
	margin: 0;
	font-weight: normal;
	font-size: 100%;
	color: #444;
}

.ProseMirror-prompt input[type="text"],
.ProseMirror-prompt textarea {
	background: #eee;
	border: none;
	outline: none;
}

.ProseMirror-prompt input[type="text"] {
	padding: 0 4px;
}

.ProseMirror-prompt-close {
	position: absolute;
	left: 2px; top: 1px;
	color: #666;
	border: none; background: transparent; padding: 0;
}

.ProseMirror-prompt-close:after {
	content: "âœ•";
	font-size: 12px;
}

.ProseMirror-invalid {
	background: #ffc;
	border: 1px solid #cc7;
	border-radius: 4px;
	padding: 5px 10px;
	position: absolute;
	min-width: 10em;
}

.ProseMirror-prompt-buttons {
	margin-top: 5px;
	display: none;
}
//TODO END: *************************************************** REMOVE WHEN REFACTORED ***************************************************


#editor, .editor {
	height: 100%;
	background: white;
	background-clip: padding-box;
}


// DEPRECATED: Legacy AI input styles - now handled by ai-chat-thread.scss
// .ai-user-message, .ai-response-message, .ai-user-input styles removed


.ai-suggest-decorator {
	&.visible {
		opacity: 1;
	}
}
.ai-suggest-highlighted {
	font-weight: 400;
	color: #56967c;
}
